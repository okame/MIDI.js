/*
 -------------------------------------------------------------------
   module: Base64Binary
      src: http://blog.danguer.com/2011/10/24/base64-binary-decoding-in-javascript/
  license: Simplified BSD License
 -------------------------------------------------------------------
 Copyright 2011, Daniel Guerrero. All rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are met:
     - Redistributions of source code must retain the above copyright
       notice, this list of conditions and the following disclaimer.
     - Redistributions in binary form must reproduce the above copyright
       notice, this list of conditions and the following disclaimer in the
       documentation and/or other materials provided with the distribution.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 DISCLAIMED. IN NO EVENT SHALL DANIEL GUERRERO BE LIABLE FOR ANY
 DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
var MIDI={};
function Stream(a){function c(c){var f=a.charCodeAt(b);c&&127<f&&(f-=256);b+=1;return f}var b=0;return{eof:function(){return b>=a.length},read:function(c){var f=a.substr(b,c);b+=c;return f},readInt32:function(){var c=(a.charCodeAt(b)<<24)+(a.charCodeAt(b+1)<<16)+(a.charCodeAt(b+2)<<8)+a.charCodeAt(b+3);b+=4;return c},readInt16:function(){var c=(a.charCodeAt(b)<<8)+a.charCodeAt(b+1);b+=2;return c},readInt8:c,readVarInt:function(){for(var a=0;;){var b=c();if(b&128)a+=b&127,a<<=7;else return a+b}}}}
function MidiFile(a){function c(a){var d=a.read(4),b=a.readInt32();return{id:d,length:b,data:a.read(b)}}function b(a){var d={};d.deltaTime=a.readVarInt();var b=a.readInt8();if(240==(b&240)){if(255==b){d.type="meta";b=a.readInt8();var c=a.readVarInt();switch(b){case 0:d.subtype="sequenceNumber";if(2!=c)throw"Expected length for sequenceNumber event is 2, got "+c;d.number=a.readInt16();return d;case 1:return d.subtype="text",d.text=a.read(c),d;case 2:return d.subtype="copyrightNotice",d.text=a.read(c),
d;case 3:return d.subtype="trackName",d.text=a.read(c),d;case 4:return d.subtype="instrumentName",d.text=a.read(c),d;case 5:return d.subtype="lyrics",d.text=a.read(c),d;case 6:return d.subtype="marker",d.text=a.read(c),d;case 7:return d.subtype="cuePoint",d.text=a.read(c),d;case 32:d.subtype="midiChannelPrefix";if(1!=c)throw"Expected length for midiChannelPrefix event is 1, got "+c;d.channel=a.readInt8();return d;case 47:d.subtype="endOfTrack";if(0!=c)throw"Expected length for endOfTrack event is 0, got "+
c;return d;case 81:d.subtype="setTempo";if(3!=c)throw"Expected length for setTempo event is 3, got "+c;d.microsecondsPerBeat=(a.readInt8()<<16)+(a.readInt8()<<8)+a.readInt8();return d;case 84:d.subtype="smpteOffset";if(5!=c)throw"Expected length for smpteOffset event is 5, got "+c;b=a.readInt8();d.frameRate={0:24,32:25,64:29,96:30}[b&96];d.hour=b&31;d.min=a.readInt8();d.sec=a.readInt8();d.frame=a.readInt8();d.subframe=a.readInt8();return d;case 88:d.subtype="timeSignature";if(4!=c)throw"Expected length for timeSignature event is 4, got "+
c;d.numerator=a.readInt8();d.denominator=Math.pow(2,a.readInt8());d.metronome=a.readInt8();d.thirtyseconds=a.readInt8();return d;case 89:d.subtype="keySignature";if(2!=c)throw"Expected length for keySignature event is 2, got "+c;d.key=a.readInt8(!0);d.scale=a.readInt8();return d;case 127:return d.subtype="sequencerSpecific",d.data=a.read(c),d;default:return d.subtype="unknown",d.data=a.read(c),d}}if(240==b)return d.type="sysEx",c=a.readVarInt(),d.data=a.read(c),d;if(247==b)return d.type="dividedSysEx",
c=a.readVarInt(),d.data=a.read(c),d;throw"Unrecognised MIDI event type byte: "+b;}0==(b&128)?(c=b,b=e):(c=a.readInt8(),e=b);var h=b>>4;d.channel=b&15;d.type="channel";switch(h){case 8:return d.subtype="noteOff",d.noteNumber=c,d.velocity=a.readInt8(),d;case 9:return d.noteNumber=c,d.velocity=a.readInt8(),d.subtype=0==d.velocity?"noteOff":"noteOn",d;case 10:return d.subtype="noteAftertouch",d.noteNumber=c,d.amount=a.readInt8(),d;case 11:return d.subtype="controller",d.controllerType=c,d.value=a.readInt8(),
d;case 12:return d.subtype="programChange",d.programNumber=c,d;case 13:return d.subtype="channelAftertouch",d.amount=c,d;case 14:return d.subtype="pitchBend",d.value=c+(a.readInt8()<<7),d;default:throw"Unrecognised MIDI event type: "+h;}}var e;stream=Stream(a);a=c(stream);if("MThd"!=a.id||6!=a.length)throw"Bad .mid file - header not found";var f=Stream(a.data);a=f.readInt16();var g=f.readInt16();f=f.readInt16();if(f&32768)throw"Expressing time division in SMTPE frames is not supported yet";ticksPerBeat=
f;a={formatType:a,trackCount:g,ticksPerBeat:ticksPerBeat};g=[];for(f=0;f<a.trackCount;f++){g[f]=[];var l=c(stream);if("MTrk"!=l.id)throw"Unexpected chunk - expected MTrk, got "+l.id;for(l=Stream(l.data);!l.eof();){var k=b(l);g[f].push(k)}}return{header:a,tracks:g}}var clone=function(a){if("object"!=typeof a||null==a)return a;var c="number"==typeof a.length?[]:{},b;for(b in a)c[b]=clone(a[b]);return c};
function Replayer(a,c,b,e){function f(){for(var c=null,d=null,b=null,f=0;f<g.length;f++)null!=g[f].ticksToNextEvent&&(null==c||g[f].ticksToNextEvent<c)&&(c=g[f].ticksToNextEvent,d=f,b=g[f].nextEventIndex);if(null!=d){var e=a.tracks[d][b];g[d].ticksToNextEvent=a.tracks[d][b+1]?g[d].ticksToNextEvent+a.tracks[d][b+1].deltaTime:null;g[d].nextEventIndex+=1;for(f=0;f<g.length;f++)null!=g[f].ticksToNextEvent&&(g[f].ticksToNextEvent-=c);return{ticksToEvent:c,event:e,track:d}}return null}var g=[],l=e?e:120,
k=e?!0:!1,m=a.header.ticksPerBeat;for(b=0;b<a.tracks.length;b++)g[b]={nextEventIndex:0,ticksToNextEvent:a.tracks[b].length?a.tracks[b][0].deltaTime:null};var d,q=[];(function(){if(d=f())for(;d;){k||"meta"!=d.event.type||"setTempo"!=d.event.subtype||(l=6E7/d.event.microsecondsPerBeat);var a=0;0<d.ticksToEvent&&(a=d.ticksToEvent/m,a/=l/60);q.push([d,1E3*a*c||0]);d=f()}})();return{getData:function(){return clone(q)}}}"undefined"===typeof MIDI&&(MIDI={});
(function(a){var c={},b=0,e=function(a){b++;var f=document.body,e=new Audio,k=a.split(";")[0];e.id="audio";e.setAttribute("preload","auto");e.setAttribute("audiobuffer",!0);e.addEventListener("error",function(){f.removeChild(e);c[k]=!1;b--},!1);e.addEventListener("canplaythrough",function(){f.removeChild(e);c[k]=!0;b--},!1);e.src="data:"+a;f.appendChild(e)};a.audioDetect=function(a){if(navigator.requestMIDIAccess)if(Function.prototype.toString.call(navigator.requestMIDIAccess).indexOf("[native code]"))c.webmidi=
!0;else for(var f=0;navigator.plugins.length>f;f++)0<=navigator.plugins[f].name.indexOf("Jazz-Plugin")&&(c.webmidi=!0);if("undefined"===typeof Audio)return a({});c.audiotag=!0;if(window.AudioContext||window.webkitAudioContext)c.webaudio=!0;var l=new Audio;if("undefined"===typeof l.canPlayType)return a(c);f=l.canPlayType('audio/ogg; codecs\x3d"vorbis"');f="probably"===f||"maybe"===f;l=l.canPlayType("audio/mpeg");l="probably"===l||"maybe"===l;if(f||l){f&&e("audio/ogg;base64,T2dnUwACAAAAAAAAAADqnjMlAAAAAOyyzPIBHgF2b3JiaXMAAAAAAUAfAABAHwAAQB8AAEAfAACZAU9nZ1MAAAAAAAAAAAAA6p4zJQEAAAANJGeqCj3//////////5ADdm9yYmlzLQAAAFhpcGguT3JnIGxpYlZvcmJpcyBJIDIwMTAxMTAxIChTY2hhdWZlbnVnZ2V0KQAAAAABBXZvcmJpcw9CQ1YBAAABAAxSFCElGVNKYwiVUlIpBR1jUFtHHWPUOUYhZBBTiEkZpXtPKpVYSsgRUlgpRR1TTFNJlVKWKUUdYxRTSCFT1jFloXMUS4ZJCSVsTa50FkvomWOWMUYdY85aSp1j1jFFHWNSUkmhcxg6ZiVkFDpGxehifDA6laJCKL7H3lLpLYWKW4q91xpT6y2EGEtpwQhhc+211dxKasUYY4wxxsXiUyiC0JBVAAABAABABAFCQ1YBAAoAAMJQDEVRgNCQVQBABgCAABRFcRTHcRxHkiTLAkJDVgEAQAAAAgAAKI7hKJIjSZJkWZZlWZameZaouaov+64u667t6roOhIasBACAAAAYRqF1TCqDEEPKQ4QUY9AzoxBDDEzGHGNONKQMMogzxZAyiFssLqgQBKEhKwKAKAAAwBjEGGIMOeekZFIi55iUTkoDnaPUUcoolRRLjBmlEluJMYLOUeooZZRCjKXFjFKJscRUAABAgAMAQICFUGjIigAgCgCAMAYphZRCjCnmFHOIMeUcgwwxxiBkzinoGJNOSuWck85JiRhjzjEHlXNOSuekctBJyaQTAAAQ4AAAEGAhFBqyIgCIEwAwSJKmWZomipamiaJniqrqiaKqWp5nmp5pqqpnmqpqqqrrmqrqypbnmaZnmqrqmaaqiqbquqaquq6nqrZsuqoum65q267s+rZru77uqapsm6or66bqyrrqyrbuurbtS56nqqKquq5nqq6ruq5uq65r25pqyq6purJtuq4tu7Js664s67pmqq5suqotm64s667s2rYqy7ovuq5uq7Ks+6os+75s67ru2rrwi65r66os674qy74x27bwy7ouHJMnqqqnqq7rmarrqq5r26rr2rqmmq5suq4tm6or26os67Yry7aumaosm64r26bryrIqy77vyrJui67r66Ys67oqy8Lu6roxzLat+6Lr6roqy7qvyrKuu7ru+7JuC7umqrpuyrKvm7Ks+7auC8us27oxuq7vq7It/KosC7+u+8Iy6z5jdF1fV21ZGFbZ9n3d95Vj1nVhWW1b+V1bZ7y+bgy7bvzKrQvLstq2scy6rSyvrxvDLux8W/iVmqratum6um7Ksq/Lui60dd1XRtf1fdW2fV+VZd+3hV9pG8OwjK6r+6os68Jry8ov67qw7MIvLKttK7+r68ow27qw3L6wLL/uC8uq277v6rrStXVluX2fsSu38QsAABhwAAAIMKEMFBqyIgCIEwBAEHIOKQahYgpCCKGkEEIqFWNSMuakZM5JKaWUFEpJrWJMSuaclMwxKaGUlkopqYRSWiqlxBRKaS2l1mJKqcVQSmulpNZKSa2llGJMrcUYMSYlc05K5pyUklJrJZXWMucoZQ5K6iCklEoqraTUYuacpA46Kx2E1EoqMZWUYgupxFZKaq2kFGMrMdXUWo4hpRhLSrGVlFptMdXWWqs1YkxK5pyUzDkqJaXWSiqtZc5J6iC01DkoqaTUYiopxco5SR2ElDLIqJSUWiupxBJSia20FGMpqcXUYq4pxRZDSS2WlFosqcTWYoy1tVRTJ6XFklKMJZUYW6y5ttZqDKXEVkqLsaSUW2sx1xZjjqGkFksrsZWUWmy15dhayzW1VGNKrdYWY40x5ZRrrT2n1mJNMdXaWqy51ZZbzLXnTkprpZQWS0oxttZijTHmHEppraQUWykpxtZara3FXEMpsZXSWiypxNhirLXFVmNqrcYWW62ltVprrb3GVlsurdXcYqw9tZRrrLXmWFNtBQAADDgAAASYUAYKDVkJAEQBAADGMMYYhEYpx5yT0ijlnHNSKucghJBS5hyEEFLKnINQSkuZcxBKSSmUklJqrYVSUmqttQIAAAocAAACbNCUWByg0JCVAEAqAIDBcTRNFFXVdX1fsSxRVFXXlW3jVyxNFFVVdm1b+DVRVFXXtW3bFn5NFFVVdmXZtoWiqrqybduybgvDqKqua9uybeuorqvbuq3bui9UXVmWbVu3dR3XtnXd9nVd+Bmzbeu2buu+8CMMR9/4IeTj+3RCCAAAT3AAACqwYXWEk6KxwEJDVgIAGQAAgDFKGYUYM0gxphhjTDHGmAAAgAEHAIAAE8pAoSErAoAoAADAOeecc84555xzzjnnnHPOOeecc44xxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY0wAwE6EA8BOhIVQaMhKACAcAABACCEpKaWUUkoRU85BSSmllFKqFIOMSkoppZRSpBR1lFJKKaWUIqWgpJJSSimllElJKaWUUkoppYw6SimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaVUSimllFJKKaWUUkoppRQAYPLgAACVYOMMK0lnhaPBhYasBAByAwAAhRiDEEJpraRUUkolVc5BKCWUlEpKKZWUUqqYgxBKKqmlklJKKbXSQSihlFBKKSWUUkooJYQQSgmhlFRCK6mEUkoHoYQSQimhhFRKKSWUzkEoIYUOQkmllNRCSB10VFIpIZVSSiklpZQ6CKGUklJLLZVSWkqpdBJSKamV1FJqqbWSUgmhpFZKSSWl0lpJJbUSSkklpZRSSymFVFJJJYSSUioltZZaSqm11lJIqZWUUkqppdRSSiWlkEpKqZSSUmollZRSaiGVlEpJKaTUSimlpFRCSamlUlpKLbWUSkmptFRSSaWUlEpJKaVSSksppRJKSqmllFpJKYWSUkoplZJSSyW1VEoKJaWUUkmptJRSSymVklIBAEAHDgAAAUZUWoidZlx5BI4oZJiAAgAAQABAgAkgMEBQMApBgDACAQAAAADAAAAfAABHARAR0ZzBAUKCwgJDg8MDAAAAAAAAAAAAAACAT2dnUwAEAAAAAAAAAADqnjMlAgAAADzQPmcBAQA\x3d");
l&&e("audio/mpeg;base64,/+MYxAAAAANIAUAAAASEEB/jwOFM/0MM/90b/+RhST//w4NFwOjf///PZu////9lns5GFDv//l9GlUIEEIAAAgIg8Ir/JGq3/+MYxDsLIj5QMYcoAP0dv9HIjUcH//yYSg+CIbkGP//8w0bLVjUP///3Z0x5QCAv/yLjwtGKTEFNRTMuOTeqqqqqqqqqqqqq/+MYxEkNmdJkUYc4AKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq");var k=(new Date).getTime(),m=window.setInterval(function(){var d=5E3<(new Date).getTime()-k;if(!b||d)window.clearInterval(m),a(c)},1)}else a(c)}})(MIDI);
(function(a){a.GM=function(a){var c=function(a){return a.replace(/[^a-z0-9 ]/gi,"").replace(/[ ]/g,"_").toLowerCase()},e={byName:{},byId:{},byCategory:{}},f;for(f in a)for(var g=a[f],l=0,k=g.length;l<k;l++){var m=g[l];if(m){var d=parseInt(m.substr(0,m.indexOf(" ")),10);m=m.replace(d+" ","");e.byId[--d]=e.byName[c(m)]=e.byCategory[c(f)]={id:c(m),instrument:m,number:d,category:f}}}return e}({Piano:"1 Acoustic Grand Piano;2 Bright Acoustic Piano;3 Electric Grand Piano;4 Honky-tonk Piano;5 Electric Piano 1;6 Electric Piano 2;7 Harpsichord;8 Clavinet".split(";"),
"Chromatic Percussion":"9 Celesta;10 Glockenspiel;11 Music Box;12 Vibraphone;13 Marimba;14 Xylophone;15 Tubular Bells;16 Dulcimer".split(";"),Organ:"17 Drawbar Organ;18 Percussive Organ;19 Rock Organ;20 Church Organ;21 Reed Organ;22 Accordion;23 Harmonica;24 Tango Accordion".split(";"),Guitar:"25 Acoustic Guitar (nylon);26 Acoustic Guitar (steel);27 Electric Guitar (jazz);28 Electric Guitar (clean);29 Electric Guitar (muted);30 Overdriven Guitar;31 Distortion Guitar;32 Guitar Harmonics".split(";"),
Bass:"33 Acoustic Bass;34 Electric Bass (finger);35 Electric Bass (pick);36 Fretless Bass;37 Slap Bass 1;38 Slap Bass 2;39 Synth Bass 1;40 Synth Bass 2".split(";"),Strings:"41 Violin;42 Viola;43 Cello;44 Contrabass;45 Tremolo Strings;46 Pizzicato Strings;47 Orchestral Harp;48 Timpani".split(";"),Ensemble:"49 String Ensemble 1;50 String Ensemble 2;51 Synth Strings 1;52 Synth Strings 2;53 Choir Aahs;54 Voice Oohs;55 Synth Choir;56 Orchestra Hit".split(";"),Brass:"57 Trumpet;58 Trombone;59 Tuba;60 Muted Trumpet;61 French Horn;62 Brass Section;63 Synth Brass 1;64 Synth Brass 2".split(";"),
Reed:"65 Soprano Sax;66 Alto Sax;67 Tenor Sax;68 Baritone Sax;69 Oboe;70 English Horn;71 Bassoon;72 Clarinet".split(";"),Pipe:"73 Piccolo;74 Flute;75 Recorder;76 Pan Flute;77 Blown Bottle;78 Shakuhachi;79 Whistle;80 Ocarina".split(";"),"Synth Lead":"81 Lead 1 (square);82 Lead 2 (sawtooth);83 Lead 3 (calliope);84 Lead 4 (chiff);85 Lead 5 (charang);86 Lead 6 (voice);87 Lead 7 (fifths);88 Lead 8 (bass + lead)".split(";"),"Synth Pad":"89 Pad 1 (new age);90 Pad 2 (warm);91 Pad 3 (polysynth);92 Pad 4 (choir);93 Pad 5 (bowed);94 Pad 6 (metallic);95 Pad 7 (halo);96 Pad 8 (sweep)".split(";"),
"Synth Effects":"97 FX 1 (rain);98 FX 2 (soundtrack);99 FX 3 (crystal);100 FX 4 (atmosphere);101 FX 5 (brightness);102 FX 6 (goblins);103 FX 7 (echoes);104 FX 8 (sci-fi)".split(";"),Ethnic:"105 Sitar;106 Banjo;107 Shamisen;108 Koto;109 Kalimba;110 Bagpipe;111 Fiddle;112 Shanai".split(";"),Percussive:"113 Tinkle Bell;114 Agogo;115 Steel Drums;116 Woodblock;117 Taiko Drum;118 Melodic Tom;119 Synth Drum".split(";"),"Sound effects":"120 Reverse Cymbal;121 Guitar Fret Noise;122 Breath Noise;123 Seashore;124 Bird Tweet;125 Telephone Ring;126 Helicopter;127 Applause;128 Gunshot".split(";")});
a.getInstrument=function(c){return(c=a.channels[c])&&c.instrument};a.setInstrument=function(c,b,e){var f=a.channels[c];if(e)return setTimeout(function(){f.instrument=b},e);f.instrument=b};a.getMono=function(c){return(c=a.channels[c])&&c.mono};a.setMono=function(c,b,e){var f=a.channels[c];if(e)return setTimeout(function(){f.mono=b},e);f.mono=b};a.getOmni=function(c){return(c=a.channels[c])&&c.omni};a.setOmni=function(c,b){var e=a.channels[c];if(delay)return setTimeout(function(){e.omni=b},delay);e.omni=
b};a.getSolo=function(c){return(c=a.channels[c])&&c.solo};a.setSolo=function(c,b){var e=a.channels[c];if(delay)return setTimeout(function(){e.solo=b},delay);e.solo=b};a.channels=function(){for(var a={},b=0;16>b;b++)a[b]={instrument:b,pitchBend:0,mute:!1,mono:!1,omni:!1,solo:!1};return a}();a.keyToNote={};a.noteToKey={};(function(){for(var c="C Db D Eb E F Gb G Ab A Bb B".split(" "),b=21;108>=b;b++){var e=c[b%12]+((b-12)/12>>0);a.keyToNote[e]=b;a.noteToKey[b]=e}})()})(MIDI);
"undefined"===typeof MIDI&&(MIDI={});MIDI.Soundfont=MIDI.Soundfont||{};MIDI.Player=MIDI.Player||{};
(function(a){a.DEBUG=!0;a.USE_XHR=!0;a.soundfontUrl="./soundfont/";a.loadPlugin=function(b){"function"===typeof b&&(b={onsuccess:b});a.soundfontUrl=b.soundfontUrl||a.soundfontUrl;a.audioDetect(function(f){var e=window.location.hash,g="";f[b.api]?g=b.api:f[e.substr(1)]?g=e.substr(1):f.webmidi?g="webmidi":window.AudioContext||window.webkitAudioContext?g="webaudio":window.Audio&&(g="audiotag");c[g]&&(e=b.targetFormat?b.targetFormat:f["audio/ogg"]?"ogg":"mp3",a.__api=g,a.__audioFormat=e,a.supports=f,
a.loadResource(b))})};a.loadResource=function(b){var f=b.instruments||b.instrument||"acoustic_grand_piano";"object"!==typeof f&&(f=f||0===f?[f]:[]);for(var e=0;e<f.length;e++){var k=f[e];k===+k&&a.GM.byId[k]&&(f[e]=a.GM.byId[k].id)}b.format=a.__audioFormat;b.instruments=f;c[a.__api](b)};var c={webmidi:function(b){a.WebMIDI.connect(b)},audiotag:function(a){b(a,"AudioTag")},webaudio:function(a){b(a,"WebAudio")}},b=function(b,c){for(var f=b.format,g=b.instruments,m=b.onprogress,d=b.onerror,q=g.length,
r=q,h=function(){--r||(m&&m("load",1),a[c].connect(b))},n=0;n<q;n++){var p=g[n];MIDI.Soundfont[p]?h():e(g[n],f,function(a,b){a=b/q;b=(q-r)/q;m&&m("load",a+b,p)},function(){h()},d)}},e=function(b,c,e,k,m){c=a.soundfontUrl+b+"-"+c+".js";a.USE_XHR?a.util.request({url:c,format:"text",onerror:m,onprogress:e,onsuccess:function(a,b){a=document.createElement("script");a.language="javascript";a.type="text/javascript";a.text=b;document.body.appendChild(a);k()}}):dom.loadScript.add({url:c,verify:'MIDI.Soundfont["'+
b+'"]',onerror:m,onsuccess:function(){k()}})};a.setDefaultPlugin=function(b){for(var c in b)a[c]=b[c]}})(MIDI);"undefined"===typeof MIDI&&(MIDI={});"undefined"===typeof MIDI.Player&&(MIDI.Player={});
(function(){var a=MIDI.Player;a.currentTime=0;a.endTime=0;a.restart=0;a.playing=!1;a.timeWarp=1;a.startDelay=0;a.BPM=120;a.start=a.resume=function(b){-1>a.currentTime&&(a.currentTime=-1);q(a.currentTime,null,b)};a.pause=function(){var b=a.restart;r();a.restart=b};a.stop=function(){r();a.restart=0;a.currentTime=0};a.addListener=function(a){g=a};a.removeListener=function(){g=void 0};a.clearAnimation=function(){a.animationFrameId&&cancelAnimationFrame(a.animationFrameId)};a.setAnimation=function(b){var c=
0,d=0,h=0;a.clearAnimation();var e=function(){a.animationFrameId=requestAnimationFrame(e);if(0!==a.endTime){a.playing?(c=h===a.currentTime?d-Date.now():0,c=0===a.currentTime?0:a.currentTime-c,h!==a.currentTime&&(d=Date.now(),h=a.currentTime)):c=a.currentTime;var n=c/1E3,p=n/60;n=60*p+(n-60*p);p=a.endTime/1E3;-1>p-n||b({now:n,end:p,events:f})}};requestAnimationFrame(e)};a.loadMidiFile=function(b,c,d){try{a.replayer=new Replayer(MidiFile(a.currentData),a.timeWarp,null,a.BPM),a.data=a.replayer.getData(),
a.endTime=m(),MIDI.loadPlugin({onsuccess:b,onprogress:c,onerror:d})}catch(A){d&&d(A)}};a.loadFile=function(b,c,d,f){a.stop();if(-1!==b.indexOf("base64,"))b=window.atob(b.split(",")[1]),a.currentData=b,a.loadMidiFile(c,d,f);else{var e=new XMLHttpRequest;e.open("GET",b);e.overrideMimeType("text/plain; charset\x3dx-user-defined");e.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){for(var b=this.responseText||"",e=[],h=b.length,n=String.fromCharCode,p=0;p<h;p++)e[p]=n(b.charCodeAt(p)&
255);b=e.join("");a.currentData=b;a.loadMidiFile(c,d,f)}else f&&f("Unable to load MIDI file")};e.send()}};a.getFileInstruments=function(){for(var b={},c={},d=0;d<a.data.length;d++){var f=a.data[d][0].event;if("channel"===f.type){var e=f.channel;switch(f.subtype){case "programChange":c[e]=f.programNumber;break;case "noteOn":f=c[e],e=MIDI.GM.byId[isFinite(f)?f:e],b[e.id]=!0}}}c=[];for(var g in b)c.push(g);return c};var c=[],b,e=0,f={},g=void 0,l=function(d,e,p,r,m,l,k){return setTimeout(function(){var h=
{channel:d,note:e,now:p,end:a.endTime,message:m,velocity:l};128===m?delete f[e]:f[e]=h;g&&g(h);a.currentTime=p;c.shift();1E3>c.length?q(b,!0):a.currentTime===b&&b<a.endTime&&q(b,!0)},p-r)},k=function(){if("webaudio"===MIDI.api)return MIDI.WebAudio.getContext();a.ctx={currentTime:0};return a.ctx},m=function(){for(var b=a.data,c=b.length,d=.5,f=0;f<c;f++)d+=b[f][1];return d},d,q=function(f,n,g){if(a.replayer){n||("undefined"===typeof f&&(f=a.restart),a.playing&&r(),a.playing=!0,a.data=a.replayer.getData(),
a.endTime=m());var h=n=0,p=a.data,q=k(),B=p.length;b=.5;var y=f-a.currentTime;if("webaudio"!==MIDI.api){var v=window.performance&&window.performance.now?window.performance.now():Date.now();d=d||v;q.currentTime=(v-d)/1E3}e=q.currentTime;for(v=0;v<B&&100>h;v++){var t=p[v];if((b+=t[1])<=f)n=b;else if(f=b-n,t=t[0].event,"channel"===t.type){var u=t.channel;var w=MIDI.channels[u];var x=q.currentTime+(f+y+a.startDelay)/1E3,z=b-n+a.startDelay;switch(t.subtype){case "controller":MIDI.setController(u,t.controllerType,
t.value,x);break;case "programChange":MIDI.programChange(u,t.programNumber,x);break;case "pitchBend":MIDI.pitchBend(u,t.value,x);break;case "noteOn":if(w.mute)break;w=t.noteNumber-(a.MIDIOffset||0);c.push({event:t,time:z,source:MIDI.noteOn(u,t.noteNumber,t.velocity,x),interval:l(u,w,b+a.startDelay,n-y,144,t.velocity)});h++;break;case "noteOff":w.mute||(w=t.noteNumber-(a.MIDIOffset||0),c.push({event:t,time:z,source:MIDI.noteOff(u,t.noteNumber,x),interval:l(u,w,b,n-y,128,0)}))}}}g&&g(c)}},r=function(){var b=
k();a.playing=!1;for(a.restart+=1E3*(b.currentTime-e);c.length;)b=c.pop(),window.clearInterval(b.interval),b.source&&("number"===typeof b.source?window.clearTimeout(b.source):b.source.disconnect(0));for(var d in f)b=f[d],144===f[d].message&&g&&g({channel:b.channel,note:b.note,now:b.now,end:b.end,message:128,velocity:b.velocity});f={}}})();
(function(a){window.Audio&&function(){for(var c=a.AudioTag={api:"audiotag"},b={},e=127,f=-1,g=[],l=[],k={},m=0;12>m;m++)g[m]=new Audio;var d=function(b,c){if(a.channels[b]&&(b=a.GM.byId[a.channels[b].instrument].id,c=k[c])){var d=(f+1)%g.length,h=g[d];l[d]=b+""+c.id;a.Soundfont[b]?(h.src=a.Soundfont[b][c.id],h.volume=e/127,h.play(),f=d):a.DEBUG&&console.log("404",b)}},q=function(b,c){if(a.channels[b]&&(b=a.GM.byId[a.channels[b].instrument].id,c=k[c])){c=b+""+c.id;b=0;for(var d=g.length;b<d;b++){var e=
(b+f+1)%d,h=l[e];if(h&&h==c){g[e].pause();l[e]=null;break}}}};c.audioBuffers=g;c.send=function(a,b){};c.setController=function(a,b,c,d){};c.setVolume=function(a,b){e=b};c.programChange=function(b,c){a.channels[b].instrument=c};c.pitchBend=function(a,b,c){};c.noteOn=function(a,c,f,e){var g=b[c];if(k[g]){if(e)return setTimeout(function(){d(a,g)},1E3*e);d(a,g)}};c.noteOff=function(a,b,c){};c.chordOn=function(a,c,f,e){for(f=0;f<c.length;f++){var g=b[c[f]];if(k[g]){if(e)return setTimeout(function(){d(a,
g)},1E3*e);d(a,g)}}};c.chordOff=function(a,c,d){for(var f=0;f<c.length;f++){var e=b[c[f]];if(k[e]){if(d)return setTimeout(function(){q(a,e)},1E3*d);q(a,e)}}};c.stopAllNotes=function(){for(var a=0,b=g.length;a<b;a++)g[a].pause()};c.connect=function(d){a.setDefaultPlugin(c);for(var f in a.keyToNote)b[a.keyToNote[f]]=f,k[f]={id:f};d.onsuccess&&d.onsuccess()}}()})(MIDI);
(function(a){(window.AudioContext||window.webkitAudioContext)&&function(){function c(a,b,c){if(0===a.indexOf("data:audio"))a=a.split(",")[1],a=Base64Binary.decodeArrayBuffer(a),e.decodeAudioData(a,b,c);else{var d=new XMLHttpRequest;d.open("GET",a,!0);d.responseType="arraybuffer";d.onload=function(){e.decodeAudioData(d.response,b,c)};d.send()}}var b=a.WebAudio={api:"webaudio"},e,f={},g={},l=127,k={};b.audioBuffers=k;b.send=function(a,b){};b.setController=function(a,b,c,f){};b.setVolume=function(a,
b,c){c?setTimeout(function(){l=b},1E3*c):l=b};b.programChange=function(b,c,f){a.channels[b].instrument=c};b.pitchBend=function(b,c,f){a.channels[b].pitchBend=c};b.noteOn=function(b,c,q,r){e.createBufferSource().start(0);r=r||0;var d=k[a.channels[b].instrument+""+c];if(d){r<e.currentTime&&(r+=e.currentTime);var n=e.createBufferSource();n.buffer=d;if(g){d=n;for(var p in g)d.connect(g[p].input),d=g[p]}q=q/127*(l/127)*2-1;n.connect(e.destination);n.playbackRate.value=1;n.gainNode=e.createGain();n.gainNode.connect(e.destination);
n.gainNode.gain.value=Math.min(1,Math.max(-1,q));n.connect(n.gainNode);n.start(r||0);return f[b+""+c]=n}};b.noteOff=function(b,c,g){g=g||0;if(k[a.channels[b].instrument+""+c]){g<e.currentTime&&(g+=e.currentTime);var d=f[b+""+c];if(d){if(d.gainNode){var h=d.gainNode.gain;h.linearRampToValueAtTime(h.value,g);h.linearRampToValueAtTime(-1,g+.3)}d.noteOff?d.noteOff(g+.5):d.stop(g+.5);delete f[b+""+c];return d}}};b.chordOn=function(a,c,f,e){for(var d={},g=0,p,l=c.length;g<l;g++)d[p=c[g]]=b.noteOn(a,p,f,
e);return d};b.chordOff=function(a,c,f){for(var d={},e=0,g,p=c.length;e<p;e++)d[g=c[e]]=b.noteOff(a,g,f);return d};b.stopAllNotes=function(){for(var a in f){var b=0;b<e.currentTime&&(b+=e.currentTime);var c=f[a];c.gain.linearRampToValueAtTime(1,b);c.gain.linearRampToValueAtTime(0,b+.3);c.noteOff?c.noteOff(b+.3):c.stop(b+.3);delete f[a]}};b.setEffects=function(a){if(e.tunajs)for(var b=0;b<a.length;b++){var c=a[b],f=new e.tunajs[c.type](c);f.connect(e.destination);g[c.type]=f}else return console.log("Effects module not installed.")};
b.connect=function(c){a.setDefaultPlugin(b);b.setContext(e||new (window.AudioContext||window.webkitAudioContext),c.onsuccess)};b.getContext=function(){return e};b.setContext=function(b,d,f,g){e=b;"undefined"===typeof Tuna||e.tunajs||(e.tunajs=new Tuna(e));b=[];f=a.keyToNote;for(var l in f)b.push(l);var n=function(a){for(var b in p)if(p[b])return;d&&(d(),d=null)};f=function(b,d,f,e){if(f=b[e])p[d]++,c(f,function(c){c.id=e;k[d+""+a.keyToNote[e]]=c;0===--p[d]&&(b.isLoaded=!0,n(m))},function(a){})};var p=
{},m;for(m in a.Soundfont)if(g=a.Soundfont[m],!g.isLoaded)for(var q=a.GM.byName[m].number,r=p[q]=0;r<b.length;r++)l=b[r],f(g,q,r,l);setTimeout(n,1)}}()})(MIDI);
(function(a){var c=null,b=null,e=a.WebMIDI={api:"webmidi"};e.send=function(a,c){b.send(a,1E3*c)};e.setController=function(a,c,e,k){b.send([a,c,e],1E3*k)};e.setVolume=function(a,c,e){b.send([176+a,7,c],1E3*e)};e.programChange=function(a,c,e){b.send([192+a,c],1E3*e)};e.pitchBend=function(a,c,e){b.send([224+a,c],1E3*e)};e.noteOn=function(a,c,e,k){b.send([144+a,c,e],1E3*k)};e.noteOff=function(a,c,e){b.send([128+a,c,0],1E3*e)};e.chordOn=function(a,c,e,k){for(var f=0;f<c.length;f++)b.send([144+a,c[f],e],
1E3*k)};e.chordOff=function(a,c,e){for(var f=0;f<c.length;f++)b.send([128+a,c[f],0],1E3*e)};e.stopAllNotes=function(){b.cancel();for(var a=0;16>a;a++)b.send([176+a,123,0])};e.connect=function(f){a.setDefaultPlugin(e);var g=function(b){if(window.AudioContext)f.api="webaudio";else if(window.Audio)f.api="audiotag";else return;a.loadPlugin(f)};navigator.requestMIDIAccess().then(function(a){c=a;a=c.outputs;b="function"==typeof a?a()[0]:a[0];void 0===b?g():f.onsuccess&&f.onsuccess()},g)}})(MIDI);
"undefined"===typeof MIDI&&(MIDI={});
(function(a){(a.util||(a.util={})).request=function(c,b,e,f){"string"===typeof c&&(c={url:c});var g=c.data,l=c.url,k=c.method||(c.data?"POST":"GET"),m=c.format,d=c.headers,q=c.responseType,r=c.withCredentials||!1;b=b||c.onsuccess;e=e||c.onerror;f=f||c.onprogress;if("undefined"!==typeof NodeFS&&a.loc.isLocalUrl(l))NodeFS.readFile(l,"utf8",function(a,c){a?e&&e(a):b&&b({responseText:c})});else{var h=new XMLHttpRequest;h.open(k,l,!0);if(d)for(var n in d)h.setRequestHeader(n,d[n]);else g&&h.setRequestHeader("Content-type",
"application/x-www-form-urlencoded");"binary"===m&&h.overrideMimeType&&h.overrideMimeType("text/plain; charset\x3dx-user-defined");q&&(h.responseType=q);r&&(h.withCredentials="true");e&&"onerror"in h&&(h.onerror=e);f&&h.upload&&"onprogress"in h.upload&&(g?h.upload.onprogress=function(a){f.call(h,a,event.loaded/event.total)}:h.addEventListener("progress",function(a){if(a.lengthComputable)var b=a.total;else if(h.totalBytes)b=h.totalBytes;else if(b=parseInt(h.getResponseHeader("Content-Length-Raw")),
isFinite(b))h.totalBytes=b;else return;f.call(h,a,a.loaded/b)}));h.onreadystatechange=function(c){if(4===h.readyState)if(200===h.status||304===h.status||308===h.status||0===h.status&&a.client.cordova){if(b){if("xml"===m)var d=c.target.responseXML;else if("text"===m)d=c.target.responseText;else if("json"===m)try{d=JSON.parse(c.target.response)}catch(C){e&&e.call(h,c)}b.call(h,c,d)}}else e&&e.call(h,c)};h.send(g);return h}}})(MIDI);if("undefined"===typeof dom)var dom={};
(function(){dom.loadScript=function(){this.loaded={};this.loading={};return this};dom.loadScript.prototype.add=function(c){var b=this;"string"===typeof c&&(c={url:c});var e=c.urls;"undefined"===typeof e&&(e=[{url:c.url,verify:c.verify}]);var f=document.getElementsByTagName("head")[0],g=function(c,d){if(!(b.loaded[c.url]||d&&!1===a(d))){b.loaded[c.url]=!0;if(b.loading[c.url])b.loading[c.url]();delete b.loading[c.url];if(c.onsuccess)c.onsuccess();"undefined"!==typeof h&&h()}},l=!1,k=[],m=function(a){"string"===
typeof a&&(a={url:a,verify:c.verify});if(/([\w\d.\[\]\'\"])$/.test(a.verify)){var e=a.test=a.verify;if("object"===typeof e)for(var h=0;h<e.length;h++)k.push(e[h]);else k.push(e)}b.loaded[a.url]||(e=document.createElement("script"),e.onreadystatechange=function(){"loaded"!==this.readyState&&"complete"!==this.readyState||g(a)},e.onload=function(){g(a)},e.onerror=function(){l=!0;delete b.loading[a.url];if("object"===typeof a.test)for(var c in a.test)d(a.test[c]);else d(a.test)},e.setAttribute("type",
"text/javascript"),e.setAttribute("src",a.url),f.appendChild(e),b.loading[a.url]=function(){})},d=function(a){for(var b=[],c=0;c<k.length;c++)k[c]!==a&&b.push(k[c]);k=b},q=function(b){if(b)g(b,b.test);else for(var d=0;d<e.length;d++)g(e[d],e[d].test);var f=!0;for(d=0;d<k.length;d++)!1===a(k[d])&&(f=!1);if(!c.strictOrder&&f)if(l)c.error&&c.error();else{if(c.onsuccess)c.onsuccess()}else setTimeout(function(){q(b)},10)};if(c.strictOrder){var r=-1,h=function(){r++;if(e[r]){var a=e[r],d=a.url;b.loading[d]?
b.loading[d]=function(){if(a.onsuccess)a.onsuccess();h()}:b.loaded[d]?h():(m(a),q(a))}else if(l)c.error&&c.error();else if(c.onsuccess)c.onsuccess()};h()}else for(r=0;r<e.length;r++)m(e[r]),q(e[r])};dom.loadScript=new dom.loadScript;var a=function(a,b){try{a=a.split('"').join("").split("'").join("").split("]").join("").split("[").join(".");var c=a.split("."),f=c.length;a=b||window;for(b=0;b<f;b++){var g=c[b];if(null==a[g])return!1;a=a[g]}return!0}catch(l){return!1}}})();
"undefined"!==typeof module&&module.exports&&(module.exports=dom.loadScript);
var Base64Binary={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d",decodeArrayBuffer:function(a){var c=new ArrayBuffer(Math.ceil(3*a.length/4));this.decode(a,c);return c},decode:function(a,c){var b=this._keyStr.indexOf(a.charAt(a.length-1)),e=this._keyStr.indexOf(a.charAt(a.length-1)),f=Math.ceil(3*a.length/4);64==b&&f--;64==e&&f--;var g;b=0;c=c?new Uint8Array(c):new Uint8Array(f);a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(g=0;g<f;g+=3){var l=this._keyStr.indexOf(a.charAt(b++));
var k=this._keyStr.indexOf(a.charAt(b++));e=this._keyStr.indexOf(a.charAt(b++));var m=this._keyStr.indexOf(a.charAt(b++));l=l<<2|k>>4;k=(k&15)<<4|e>>2;var d=(e&3)<<6|m;c[g]=l;64!=e&&(c[g+1]=k);64!=m&&(c[g+2]=d)}return c}};module.exports=MIDI;